-----------------------------------------------------------------------------------------------------
docker éƒ¨ç½²é¡¹ç›®

åœ¨ /home æˆ– /opt ç›®å½•ä¸‹è¿è¡Œ java -jar æ—¶ï¼ŒJVM å†…éƒ¨ access() ç³»ç»Ÿè°ƒç”¨å¤±è´¥ï¼Œä½† ls æ˜æ˜èƒ½çœ‹åˆ°æ–‡ä»¶ã€‚
æœ¬è´¨æ˜¯ï¼šIcedTea çš„ File.canRead() æˆ– Path.toFile().exists() å®ç°ä¸­ï¼Œå¯¹æŸäº›è·¯å¾„åšäº†é”™è¯¯çš„è§„èŒƒåŒ–å¤„ç†ï¼Œå¯¼è‡´è·¯å¾„è¢«â€œè¯¯åˆ¤â€ä¸ºä¸å­˜åœ¨ã€‚
openjdk:alpineè¿™ä¸ªç‰ˆæœ¬å­˜åœ¨é—®é¢˜


çœŸå®è¯æ®ï¼šè¿™æ˜¯ç¤¾åŒºå…¬è®¤çš„ IcedTea Bug
æœç´¢å…³é”®è¯ï¼š

icedtea alpine unable to access jarfile
alpine java access enoent
OpenJDK8 Alpine path resolution bug

è§£å†³æ–¹æ³•
âœ… æ¨èæ›¿ä»£æ–¹æ¡ˆï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ï¼š
æ–¹æ¡ˆ	                               ä¼˜ç‚¹	                   ç¼ºç‚¹
ä½¿ç”¨ /tmp + cp	                     ç®€å•ã€ç¨³å®šã€é›¶æˆæœ¬	       ä¸´æ—¶æ–‡ä»¶éœ€ç®¡ç†
æ¢ç”¨ eclipse-temurin:8-jre-alpine	   å®˜æ–¹ OpenJDKï¼Œæ— æ­¤ Bug	 éœ€è¦æ›¿æ¢ç§æœ‰é•œåƒ
ä½¿ç”¨ alpine:3.19 + openjdk:8-jre	   æ›´ç¨³å®š	                 ä½“ç§¯ç¨å¤§
âš ï¸ ä¿®æ”¹ IcedTea æºç é‡ç¼–	å½»åº•è§£å†³	å¤ªå¤æ‚ï¼Œä¸æ¨è
ğŸ’¡ å¼ºçƒˆå»ºè®®ï¼š
å¦‚æœä½ ä»¬èƒ½æ¥å—ï¼ŒæŠŠ nexus.crm.huawei.com:51443/gdtimes/openjdk:alpine æ¢æˆ eclipse-temurin:8-jre-alpineï¼Œ
è¿™æ‰æ˜¯æ ¹æ²»ä¹‹é“ã€‚

-----------------------------------------------------------------------------------------------------------------
å¾ˆå¥½ï¼Œè¿™ä¸ªé—®é¢˜éå¸¸ç»å…¸ï¼åœ¨ Kubernetesï¼ˆK8sï¼‰ä¸­ï¼Œ`Deployment` å’Œ `Service` æ˜¯ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬åˆ†å·¥æ˜ç¡®ã€ååŒå·¥ä½œï¼Œä¸‹é¢æˆ‘ç”¨â€œäººè¯â€+â€œæ¯”å–»â€å¸®ä½ å½»åº•ææ‡‚å®ƒä»¬çš„åŒºåˆ«å’Œä½œç”¨ã€‚

---

## ğŸŒŸ ä¸€å¥è¯æ€»ç»“ï¼š

- **Deployment**ï¼šè´Ÿè´£â€œ**æ€ä¹ˆè·‘åº”ç”¨**â€ â€”â€” ç®¡ç† Pod çš„ç”Ÿå‘½å‘¨æœŸã€ç‰ˆæœ¬æ›´æ–°ã€æ‰©ç¼©å®¹ã€‚
- **Service**ï¼šè´Ÿè´£â€œ**æ€ä¹ˆæ‰¾åˆ°åº”ç”¨**â€ â€”â€” ç»™å¤–é¢ä¸€ä¸ªç¨³å®šçš„å…¥å£ï¼Œè®©è¯·æ±‚èƒ½æ‰“åˆ°åç«¯çš„ Podã€‚

---

## ğŸ§± 1. Deploymentï¼šåº”ç”¨çš„â€œæŒ‡æŒ¥å®˜â€

### âœ… ä½œç”¨ï¼š
- å®šä¹‰ä½ çš„åº”ç”¨åº”è¯¥è¿è¡Œå¤šå°‘ä¸ªå‰¯æœ¬ï¼ˆPodï¼‰ã€‚
- æ§åˆ¶ Pod çš„éƒ¨ç½²æ–¹å¼ï¼ˆæ»šåŠ¨æ›´æ–°ã€è“ç»¿å‘å¸ƒç­‰ï¼‰ã€‚
- è‡ªåŠ¨æ¢å¤å´©æºƒçš„ Podã€‚
- æ”¯æŒç‰ˆæœ¬å›æ»šï¼ˆæ¯”å¦‚ä¸Šçº¿å‡ºé”™ï¼Œä¸€é”®å›åˆ°ä¸Šä¸€ç‰ˆï¼‰ã€‚

### ğŸ“Œ æ¯”å–»ï¼š
> å°±åƒä¸€ä¸ªâ€œå·¥å‚ç”Ÿäº§çº¿â€çš„è°ƒåº¦ç³»ç»Ÿã€‚  
> ä½ æƒ³ç”Ÿäº§ 3 å°æœºå™¨äººï¼ˆPodï¼‰ï¼ŒDeployment å°±å®‰æ’ 3 ä¸ªå·¥äººï¼ˆPodï¼‰å¹²æ´»ï¼Œ  
> å·¥äººæ­»äº†å®ƒè‡ªåŠ¨å«æ–°å·¥äººæ¥è¡¥ä½ï¼Œ  
> æƒ³å‡çº§æˆæ–°æ¬¾æœºå™¨äººï¼Ÿå®ƒä¹Ÿèƒ½å¹³æ»‘æ¢è£…ï¼Œä¸ä¸­æ–­ç”Ÿäº§ã€‚

### âœ… å…¸å‹é…ç½®ç‰‡æ®µï¼š
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
        - name: my-app
          image: nginx:latest
          ports:
            - containerPort: 80
```

---

## ğŸŒ 2. Serviceï¼šåº”ç”¨çš„â€œé—¨ç‰Œå· + é—¨å«â€

### âœ… ä½œç”¨ï¼š
- ç»™ä¸€ç»„ Pod æä¾›ä¸€ä¸ª **å›ºå®šçš„è®¿é—®åœ°å€ï¼ˆClusterIP / NodePort / LoadBalancerï¼‰**ã€‚
- å®ç°è´Ÿè½½å‡è¡¡ï¼šè¯·æ±‚ä¼šè¢«åˆ†å‘åˆ°åç«¯å¤šä¸ª Pod ä¸Šã€‚
- å³ä½¿ Pod æ¢äº† IPï¼ˆæ¯”å¦‚é‡å¯äº†ï¼‰ï¼ŒService ä¾ç„¶èƒ½æ­£ç¡®è½¬å‘æµé‡ã€‚

### ğŸ“Œ æ¯”å–»ï¼š
> å°±åƒä¸€ä¸ªå…¬å¸å¤§æ¥¼çš„å‰å°ç”µè¯å·ç ã€‚  
> ä½ æ‰“ç”µè¯ç»™ â€œæ€»æœº 8080â€ï¼ˆServiceï¼‰ï¼Œä¸ç®¡é‡Œé¢å“ªä¸ªå‘˜å·¥ï¼ˆPodï¼‰åœ¨ä¸Šç­ï¼Œ  
> æ€»æœºä¼šæŠŠç”µè¯è½¬ç»™æ­£åœ¨å€¼ç­çš„äººï¼Œ  
> å‘˜å·¥æ¢äº†ä¹Ÿä¸æ€•ï¼Œåªè¦å·ç ä¸å˜å°±è¡Œã€‚

### âœ… å…¸å‹é…ç½®ç‰‡æ®µï¼ˆClusterIP ç±»å‹ï¼‰ï¼š
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-app-service
spec:
  selector:
    app: my-app         # å…³è” Deployment åˆ›å»ºçš„ Pod
  ports:
    - protocol: TCP
      port: 80          # Service çš„å¯¹å¤–ç«¯å£
      targetPort: 80    # Pod å†…éƒ¨ç«¯å£
  type: ClusterIP       # åªåœ¨é›†ç¾¤å†…éƒ¨è®¿é—®
```

> ä¹‹åä½ å¯ä»¥é€šè¿‡ `my-app-service.default.svc.cluster.local` æˆ– `http://<cluster-ip>:80` è®¿é—®è¿™ä¸ªåº”ç”¨ã€‚

---

## ğŸ”— å®ƒä»¬æ˜¯æ€ä¹ˆé…åˆçš„ï¼Ÿ

```
å¤–éƒ¨è¯·æ±‚ â†’ Service (ç¨³å®šå…¥å£) â†’ è·¯ç”±åˆ°å¤šä¸ª Pod â†’ Deployment (ç®¡ç†è¿™äº› Pod)
```

âœ… æ¯”å¦‚ï¼š
- ä½ éƒ¨ç½²äº†ä¸€ä¸ª Web åº”ç”¨ï¼Œç”¨ `Deployment` æ§åˆ¶ 3 ä¸ª Nginx Podã€‚
- ç”¨ `Service` ç»™è¿™ 3 ä¸ª Pod æä¾›ä¸€ä¸ªç»Ÿä¸€çš„è®¿é—®åœ°å€ `my-web-svc:80`ã€‚
- å¤–é¢çš„æµè§ˆå™¨è®¿é—® `http://my-web-svc`ï¼Œå°±èƒ½è¢«è‡ªåŠ¨åˆ†å‘åˆ°ä»»æ„ä¸€ä¸ªå¥åº·çš„ Podã€‚

---

## ğŸ”„ è¡¥å……ï¼šå…¶ä»–ç±»å‹ Service

| ç±»å‹ | ç”¨é€” |
|------|------|
| `ClusterIP` | é»˜è®¤ï¼Œåªåœ¨é›†ç¾¤å†…éƒ¨è®¿é—®ï¼ˆé€‚åˆå¾®æœåŠ¡é—´é€šä¿¡ï¼‰ |
| `NodePort` | åœ¨æ¯ä¸ªèŠ‚ç‚¹å¼€æ”¾ä¸€ä¸ªç«¯å£ï¼Œå¤–éƒ¨å¯è®¿é—®ï¼ˆæµ‹è¯•ç”¨ï¼‰ |
| `LoadBalancer` | è‡ªåŠ¨åˆ›å»ºäº‘æœåŠ¡å•†çš„è´Ÿè½½å‡è¡¡å™¨ï¼ˆç”Ÿäº§æ¨èï¼‰ |

---

## âœ… æ€»ç»“ä¸€å¥è¯ï¼š

> **Deployment æ˜¯â€œç®¡ä½ æ€ä¹ˆè·‘â€ï¼ŒService æ˜¯â€œç®¡ä½ æ€ä¹ˆè¢«æ‰¾åˆ°â€ã€‚**
>
> æ²¡æœ‰ Deploymentï¼Œä½ æ²¡æ³•å¯é åœ°è¿è¡Œåº”ç”¨ï¼›  
> æ²¡æœ‰ Serviceï¼Œåˆ«äººæ ¹æœ¬æ‰¾ä¸åˆ°ä½ ã€‚

---

ğŸ¯ å»ºè®®å®è·µï¼š
```bash
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
kubectl get pods,svc
```
ç„¶åè®¿é—® Service çš„ IP æˆ–åŸŸåï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯çœŸèƒ½é€šï¼

éœ€è¦æˆ‘ç»™ä½ å†™ä¸ªå®Œæ•´çš„ `deployment + service` ç¤ºä¾‹å—ï¼Ÿéšæ—¶è¯´~ ğŸ˜„























æŸ¥çœ‹kafkaæ˜¯å¦å‡ºé—®é¢˜æµç¨‹
ç¬¬ä¸€æ­¥ï¼šçœ‹ Pod çŠ¶æ€ â€”â€” â€œç—…äººæœ‰æ²¡æœ‰å¿ƒè·³ï¼Ÿâ€
kubectl get po -n 154bcoc-yj |grep kafka
ç¬¬äºŒæ­¥ï¼šçœ‹ Kafka æ˜¯å¦ç›‘å¬ç«¯å£ â€”â€” â€œè€³æœµèƒ½ä¸èƒ½å¬è§ï¼Ÿâ€
kubectl exec -it kafka-statefulset-1-0 -n 154bcoc-yj -- netstat -tuln | grep 9092
tcp        0      0 10.244.8.212:9092       0.0.0.0:*               LISTEN
ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥ advertised.listeners é…ç½® â€”â€” â€œé—¨ç‰Œå·æœ‰æ²¡æœ‰å†™å¯¹ï¼Ÿâ€
kubectl exec -it kafka-statefulset-1-0 -n 154bcoc-yj -- cat /opt/kafka/config/server.properties | grep advertised.listeners
advertised.listeners=PLAINTEXT://kafka-statefulset-1-0.kafka-service-1.154bcoc-yj.svc.cluster.local:9092
ç¬¬å››æ­¥ï¼šæ£€æŸ¥ Service æ˜¯å¦æ­£å¸¸ â€”â€” â€œå¿«é€’èƒ½ä¸èƒ½é€åˆ°é—¨ï¼Ÿâ€
kubectl get svc -n 154bcoc-yj |grep kafka
kafka-service-1                ClusterIP      10.105.23.118    <none>                        9092/TCP                                        2y169d
kafka-service-2                ClusterIP      10.101.105.237   <none>                        9092/TCP                                        2y169d
kafka-service-3                ClusterIP      10.99.241.6      <none>                        9092/TCP                                        2y169d
ç¬¬äº”æ­¥ï¼šå®¢æˆ·ç«¯èƒ½å¦è¿ä¸Šï¼Ÿâ€”â€” â€œå¿«é€’å‘˜èƒ½æ•²é—¨å—ï¼Ÿâ€
kubectl exec -it <ä½ çš„å®¢æˆ·ç«¯Podå> -n <å‘½åç©ºé—´> -- /bin/sh
ç¬¬å…­æ­¥ï¼šæŸ¥çœ‹ Kafka æ—¥å¿—ä¸­çš„å…³é”®é”™è¯¯ â€”â€” â€œç—…äººåˆ°åº•å“ªé‡Œç—›ï¼Ÿâ€
kubectl logs kafka-0 -n <ä½ çš„å‘½åç©ºé—´> --tail=100
ç¬¬ä¸ƒæ­¥ï¼šæ£€æŸ¥ Kafka é›†ç¾¤çŠ¶æ€ï¼ˆå¦‚æœæœ‰å¤šä¸ª Brokerï¼‰â€”â€” â€œå›¢é˜Ÿæœ‰æ²¡æœ‰åä½œï¼Ÿâ€
kubectl exec -it kafka-0 -n <ä½ çš„å‘½åç©ºé—´> -- /bin/bash
kafka-broker-api-versions.sh --bootstrap-server localhost:9092




